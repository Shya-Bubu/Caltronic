{
  "visuals": [
    {
      "type": "plotly",
      "title": "Input Stage (Stage 1) — NPN Configuration",
      "description": "Q1 (BC549 NPN): Ra/Rb voltage divider at base, R1 at collector, R2+R3 at emitter. Collector connects directly to Q2 base.",
      "traces": [
        {
          "x": [
            "Ra/Rb\nDivider",
            "VB1",
            "Q1\n(NPN)",
            "R1\n(1.8kΩ)",
            "→ VB2\n(to Q2)"
          ],
          "y": [
            15,
            4.69,
            4.03,
            10.7,
            10.7
          ],
          "mode": "lines+markers+text",
          "text": [
            "VCC=15V",
            "VB1=4.69V",
            "VE1=4.03V",
            "VC1=10.7V",
            "→ Q2 Base"
          ],
          "textposition": "middle right",
          "marker": {
            "size": 12,
            "color": [
              "#22c55e",
              "#22d3ee",
              "#f59e0b",
              "#a78bfa",
              "#ef4444"
            ]
          },
          "line": {
            "color": "#64748b",
            "width": 2,
            "dash": "dot"
          },
          "name": "Voltage Path"
        },
        {
          "x": [
            "Ra/Rb\nDivider",
            "VB1",
            "Q1\n(NPN)"
          ],
          "y": [
            15,
            4.69,
            4.03
          ],
          "mode": "lines",
          "line": {
            "color": "#22d3ee",
            "width": 2
          },
          "name": "Base-Emitter Path",
          "showlegend": false
        }
      ],
      "layout": {
        "xaxis": {
          "title": "Component / Node"
        },
        "yaxis": {
          "title": "Voltage (V)",
          "range": [
            0,
            16
          ]
        },
        "showlegend": false,
        "annotations": [
          {
            "x": 1,
            "y": 2,
            "text": "R2=1.8kΩ + R3=82Ω\n(emitter)",
            "showarrow": false,
            "font": {
              "size": 11,
              "color": "#94a3b8"
            }
          },
          {
            "x": 3.5,
            "y": 13,
            "text": "Direct coupling\nVC1 → VB2",
            "showarrow": false,
            "font": {
              "size": 12,
              "color": "#ef4444"
            }
          }
        ]
      },
      "height": 380,
      "id": "input-stage-schematic"
    },
    {
      "id": "r1-r2-kvl-breakdown",
      "type": "plotly",
      "title": "KVL Voltage Distribution — Stage 1",
      "description": "VCC = ICQ1×R1 + VCEQ1 + ICQ1×R2. Each resistor drops approximately 4.5V.",
      "traces": [
        {
          "x": [
            "VCC"
          ],
          "y": [
            15
          ],
          "name": "Supply",
          "type": "bar",
          "marker": {
            "color": "#22d3ee"
          }
        },
        {
          "x": [
            "ICQ×R1",
            "VCEQ1",
            "ICQ×(R2+R3)"
          ],
          "y": [
            4.5,
            6,
            4.5
          ],
          "name": "Drops",
          "type": "bar",
          "marker": {
            "color": [
              "#a78bfa",
              "#f59e0b",
              "#22c55e"
            ]
          }
        }
      ],
      "layout": {
        "xaxis": {
          "title": ""
        },
        "yaxis": {
          "title": "Voltage (V)"
        },
        "barmode": "stack",
        "showlegend": true
      },
      "height": 360
    },
    {
      "id": "gain-equation-flowchart",
      "type": "plotly",
      "title": "R3 Calculation Path",
      "description": "Given Av=600, hfe2=220, R5=220Ω → R3 = hfe2×R5/Av = 80.7Ω → pick 82Ω or 68Ω (E12).",
      "traces": [
        {
          "x": [
            "hfe2=220",
            "R5=220Ω",
            "Av=600",
            "R3 calc=80.7Ω",
            "R3 E12=82Ω",
            "R3 alt=68Ω"
          ],
          "y": [
            1,
            1,
            1,
            1,
            1,
            1
          ],
          "name": "Design flow",
          "mode": "markers+text",
          "text": [
            "Given",
            "Given",
            "Spec",
            "= hfe×R5/Av",
            "Conservative",
            "Compensated"
          ],
          "textposition": "top center",
          "marker": {
            "size": [
              12,
              12,
              12,
              14,
              14,
              14
            ],
            "color": [
              "#64748b",
              "#64748b",
              "#ef4444",
              "#f59e0b",
              "#22c55e",
              "#22d3ee"
            ]
          }
        }
      ],
      "layout": {
        "xaxis": {
          "title": "Parameter"
        },
        "yaxis": {
          "visible": false
        },
        "showlegend": false
      },
      "height": 280
    },
    {
      "id": "r3-gain-headroom",
      "type": "plotly",
      "title": "Gain Headroom: R3 = 82Ω vs 68Ω",
      "description": "Choosing R3=68Ω gives Av=711 (18% headroom). After hie2 loading reduces gain by ~15%, actual gain ≈ 600.",
      "traces": [
        {
          "x": [
            "Target",
            "R3=82Ω\n(theoretical)",
            "R3=82Ω\n(actual, with hie2)",
            "R3=68Ω\n(theoretical)",
            "R3=68Ω\n(actual, with hie2)"
          ],
          "y": [
            600,
            590,
            510,
            711,
            608
          ],
          "name": "Voltage Gain",
          "type": "bar",
          "marker": {
            "color": [
              "#ef4444",
              "#a78bfa",
              "#64748b",
              "#22d3ee",
              "#22c55e"
            ]
          }
        }
      ],
      "layout": {
        "xaxis": {
          "title": "R3 Choice"
        },
        "yaxis": {
          "title": "|Av|"
        },
        "showlegend": false
      },
      "height": 380
    },
    {
      "id": "stage1-voltage-distribution",
      "type": "plotly",
      "title": "Stage 1 Node Voltages",
      "description": "DC voltages at each node of the input stage.",
      "traces": [
        {
          "x": [
            "VCC",
            "VC1\n(→VB2)",
            "VB1",
            "VE1",
            "GND"
          ],
          "y": [
            15,
            10.7,
            5.16,
            4.5,
            0
          ],
          "name": "DC Voltages",
          "mode": "lines+markers",
          "line": {
            "color": "#22d3ee",
            "width": 2.5
          },
          "marker": {
            "size": 10
          }
        }
      ],
      "layout": {
        "xaxis": {
          "title": "Node"
        },
        "yaxis": {
          "title": "Voltage (V)",
          "range": [
            0,
            16
          ]
        },
        "showlegend": false
      },
      "height": 360
    },
    {
      "id": "voltage-divider-design",
      "type": "plotly",
      "title": "Voltage Divider Stiffness Check",
      "description": "The divider current (312μA) must be >> IBQ1 (20.8μA). Ratio = 15 — well above the 10× minimum.",
      "traces": [
        {
          "x": [
            "IBQ1",
            "10× IBQ1\n(minimum)",
            "I_divider\n(actual)"
          ],
          "y": [
            20.8,
            208,
            312
          ],
          "name": "Current (μA)",
          "type": "bar",
          "marker": {
            "color": [
              "#64748b",
              "#f59e0b",
              "#22c55e"
            ]
          }
        }
      ],
      "layout": {
        "xaxis": {
          "title": ""
        },
        "yaxis": {
          "title": "Current (μA)"
        },
        "showlegend": false
      },
      "height": 340
    },
    {
      "id": "falstad-full-circuit",
      "type": "falstad-sim",
      "title": "Interactive: Complete Two-Stage Amplifier",
      "description": "The full amplifier with all designed resistor values. Apply a 1kHz input and observe the output. Measure the gain by comparing input and output amplitudes.",
      "circuitText": "$ 1 5e-6 10.20027730826997 50 5 43 0\nv 96 368 96 176 0 1 1000 0.006 0 0 0.5\nr 96 176 192 176 0 33000\nr 192 176 192 368 0 15000\nw 192 176 256 176 0\nt 256 176 304 176 0 1 -4.03 0.66 100\nr 304 80 304 128 0 1800\nr 304 224 304 288 0 1800\nr 352 288 352 368 0 82\nw 304 288 352 288 0\nw 352 368 304 368 0\nw 304 128 304 176 0\nw 304 80 464 80 0\nt 400 128 464 128 0 -1 -11.03 -0.66 100\nr 464 80 464 32 0 150\nr 464 176 464 368 0 220\nw 304 128 400 128 0\nv 304 32 304 80 0 0 40 15 0 0 0.5\nw 304 32 464 32 0\nw 96 368 464 368 0\ng 272 368 272 400 0 0\nr 528 176 528 368 0 1000\nw 464 176 528 176 0\nw 528 368 464 368 0\no 12 32 0 4098 5 0.0125 0 2 12 3\n",
      "height": 500
    },
    {
      "id": "target-vs-actual-comparison",
      "type": "plotly",
      "title": "Target vs Actual After E12 Rounding",
      "description": "All parameters deviate slightly from targets due to E12 rounding. All deviations are within 5% tolerance — the design works.",
      "traces": [
        {
          "x": [
            "VB1 (V)",
            "ICQ1 (mA)",
            "VCEQ1 (V)",
            "VB2 (V)",
            "ICQ2 (mA)",
            "Av"
          ],
          "y": [
            5,
            2.5,
            6,
            10.7,
            25,
            600
          ],
          "name": "Target",
          "type": "bar",
          "marker": {
            "color": "#22d3ee"
          }
        },
        {
          "x": [
            "VB1 (V)",
            "ICQ1 (mA)",
            "VCEQ1 (V)",
            "VB2 (V)",
            "ICQ2 (mA)",
            "Av"
          ],
          "y": [
            4.69,
            2.22,
            7,
            11.7,
            24.3,
            590
          ],
          "name": "Actual (E12)",
          "type": "bar",
          "marker": {
            "color": "#a78bfa"
          }
        }
      ],
      "layout": {
        "xaxis": {
          "title": "Parameter"
        },
        "yaxis": {
          "title": "Value"
        },
        "barmode": "group",
        "showlegend": true
      },
      "height": 400
    }
  ]
}