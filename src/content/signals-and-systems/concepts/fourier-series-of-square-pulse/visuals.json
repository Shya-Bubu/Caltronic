{
    "visuals": [
        {
            "id": "square-pulse-train",
            "type": "plotly",
            "title": "The Square Pulse Train",
            "description": "A periodic square pulse with width d and period T₀. The duty cycle d/T₀ controls how much of each period is 'on'.",
            "traces": [
                {
                    "x_expr": "Array.from({length: 800}, (_, i) => -2 + i * 4 / 800)",
                    "y_expr": "Array.from({length: 800}, (_, i) => { const t = ((-2 + i * 4 / 800) % 1 + 1) % 1; return t < 0.25 || t > 0.75 ? 1 : 0; })",
                    "mode": "lines",
                    "name": "Square pulse (d/T₀ = 0.5)",
                    "line": {
                        "color": "#4f8cff",
                        "width": 2.5
                    }
                }
            ],
            "layout": {
                "xaxis": {
                    "title": "t / T₀"
                },
                "yaxis": {
                    "title": "x(t)",
                    "range": [
                        -0.2,
                        1.3
                    ]
                },
                "showlegend": true
            }
        },
        {
            "id": "pulse-duty-cycle-sim",
            "type": "v3-waveform",
            "title": "Interactive: Vary the Duty Cycle",
            "description": "Adjust the duty cycle d/T₀ and watch how the pulse width changes."
        },
        {
            "id": "integration-setup",
            "type": "plotly",
            "title": "Integration Setup: Applying the Analysis Formula",
            "description": "To find X_k, multiply the square pulse by e^{−jkω₀t} and integrate over one period. Since x(t)=1 only for |t| < d/2, the integral simplifies.",
            "traces": [
                {
                    "x_expr": "Array.from({length: 400}, (_, i) => -0.5 + i / 400)",
                    "y_expr": "Array.from({length: 400}, (_, i) => { const t = -0.5 + i / 400; return Math.abs(t) < 0.125 ? 1 : 0; })",
                    "mode": "lines",
                    "name": "x(t) pulse (d/T₀ = 0.25)",
                    "line": {
                        "color": "#4f8cff",
                        "width": 2
                    },
                    "fill": "tozeroy",
                    "fillcolor": "rgba(79,140,255,0.2)"
                },
                {
                    "x_expr": "Array.from({length: 400}, (_, i) => -0.5 + i / 400)",
                    "y_expr": "Array.from({length: 400}, (_, i) => { const t = -0.5 + i / 400; return Math.cos(2 * Math.PI * 3 * t); })",
                    "mode": "lines",
                    "name": "Re{e^{−j3ω₀t}} (k=3 example)",
                    "line": {
                        "color": "#ff6b8a",
                        "width": 1.5,
                        "dash": "dash"
                    }
                }
            ],
            "layout": {
                "xaxis": {
                    "title": "t / T₀"
                },
                "yaxis": {
                    "title": "Amplitude"
                },
                "showlegend": true
            }
        },
        {
            "id": "derivation-block-diagram",
            "type": "plotly",
            "title": "Derivation Flow: From Definition to sinc",
            "description": "Apply the analysis integral to the rectangular pulse, simplify using Euler's formula, arrive at sinc.",
            "traces": [
                {
                    "x": [
                        "X_k = (1/T₀)∫\nx(t)e^{−jkω₀t}dt",
                        "→ Pulse is 1\nover [−d/2, d/2] →",
                        "→ Euler's →",
                        "X_k = (d/T₀)\nsinc(kd/T₀)"
                    ],
                    "y": [
                        1,
                        1,
                        1,
                        1
                    ],
                    "type": "bar",
                    "marker": {
                        "color": [
                            "#4f8cff",
                            "#6b62ff",
                            "#f5a623",
                            "#2fbf8f"
                        ]
                    },
                    "text": [
                        "Analysis\nformula",
                        "Simplify\nintegrand",
                        "Euler's\nformula",
                        "sinc\nresult"
                    ],
                    "textposition": "inside",
                    "textfont": {
                        "size": 10,
                        "color": "#ffffff"
                    },
                    "showlegend": false,
                    "hoverinfo": "none"
                }
            ],
            "layout": {
                "xaxis": {
                    "title": ""
                },
                "yaxis": {
                    "visible": false,
                    "range": [
                        0,
                        1.3
                    ]
                },
                "showlegend": false
            },
            "height": 280
        },
        {
            "id": "sinc-continuous-envelope",
            "type": "plotly",
            "title": "The Continuous sinc Envelope",
            "description": "sinc(x) = sin(πx)/(πx). The Fourier coefficients are samples of this continuous function at integer k values.",
            "traces": [
                {
                    "x_expr": "Array.from({length: 300}, (_, i) => -6 + i * 12 / 300)",
                    "y_expr": "Array.from({length: 300}, (_, i) => { const x = -6 + i * 12 / 300; if(Math.abs(x) < 0.001) return 1; return Math.sin(Math.PI * x) / (Math.PI * x); })",
                    "mode": "lines",
                    "name": "sinc(x) envelope",
                    "line": {
                        "color": "#6b62ff",
                        "width": 2
                    }
                },
                {
                    "x_expr": "Array.from({length: 11}, (_, i) => i - 5).filter(x => x !== 0)",
                    "y_expr": "Array.from({length: 11}, (_, i) => i - 5).filter(x => x !== 0).map(() => 0)",
                    "mode": "markers",
                    "name": "Zeros at integers",
                    "marker": {
                        "size": 8,
                        "color": "#ff6b8a"
                    }
                }
            ],
            "layout": {
                "xaxis": {
                    "title": "x"
                },
                "yaxis": {
                    "title": "sinc(x)"
                },
                "showlegend": true
            }
        },
        {
            "id": "sinc-spectrum-bar",
            "type": "plotly",
            "title": "Fourier Coefficients: Samples of sinc Envelope",
            "description": "X_k follows a sinc envelope: X_k = (d/T₀) sinc(kd/T₀). First null at k = T₀/d.",
            "traces": [
                {
                    "x_expr": "Array.from({length: 31}, (_, i) => i - 15)",
                    "y_expr": "Array.from({length: 31}, (_, i) => { const k = i - 15; if(k === 0) return 0.25; return 0.25 * Math.sin(k * Math.PI * 0.25) / (k * Math.PI * 0.25); })",
                    "type": "bar",
                    "name": "X_k (sinc envelope)",
                    "marker": {
                        "color": "#4f8cff"
                    }
                }
            ],
            "layout": {
                "xaxis": {
                    "title": "Harmonic k",
                    "dtick": 3
                },
                "yaxis": {
                    "title": "X_k"
                },
                "showlegend": false
            }
        },
        {
            "id": "bandwidth-duration-compare",
            "type": "plotly",
            "title": "Time-Bandwidth Duality: Narrow Pulse ↔ Wide Spectrum",
            "description": "A narrow pulse (small d) has a wide spectrum. A wide pulse has a narrow spectrum.",
            "traces": [
                {
                    "x": [
                        "Narrow pulse\n(small d/T₀)",
                        "Wide pulse\n(large d/T₀)"
                    ],
                    "y": [
                        1,
                        1
                    ],
                    "type": "bar",
                    "marker": {
                        "color": [
                            "#ff6b8a",
                            "#2fbf8f"
                        ]
                    },
                    "text": [
                        "Wide spectrum\n(first null at large k)\nMany harmonics needed",
                        "Narrow spectrum\n(first null at small k)\nFewer harmonics"
                    ],
                    "textposition": "inside",
                    "textfont": {
                        "size": 10,
                        "color": "#ffffff"
                    },
                    "showlegend": false,
                    "hoverinfo": "none"
                }
            ],
            "layout": {
                "xaxis": {
                    "title": "Pulse Type"
                },
                "yaxis": {
                    "visible": false,
                    "range": [
                        0,
                        1.3
                    ]
                },
                "showlegend": false
            },
            "height": 280
        },
        {
            "id": "reconstruction-harmonics",
            "type": "v3-waveform",
            "title": "Interactive: Reconstruct the Square Pulse from Harmonics",
            "description": "Add harmonics progressively and watch the sum approximate the square pulse."
        },
        {
            "id": "convergence-comparison",
            "type": "plotly",
            "title": "Convergence: Partial Sums with 3, 7, and 15 Harmonics",
            "description": "More harmonics give a better approximation. Gibbs overshoot at edges persists but narrows.",
            "traces": [
                {
                    "x_expr": "Array.from({length: 400}, (_, i) => -Math.PI + i * 2 * Math.PI / 400)",
                    "y_expr": "Array.from({length: 400}, (_, i) => { const t = -Math.PI + i * 2 * Math.PI / 400; let s = 0; for(let k=1; k<=15; k+=2) s += (4/(k*Math.PI))*Math.sin(k*t); return s; })",
                    "mode": "lines",
                    "name": "N=15",
                    "line": {
                        "color": "#2fbf8f",
                        "width": 2.5
                    }
                },
                {
                    "x_expr": "Array.from({length: 400}, (_, i) => -Math.PI + i * 2 * Math.PI / 400)",
                    "y_expr": "Array.from({length: 400}, (_, i) => { const t = -Math.PI + i * 2 * Math.PI / 400; let s = 0; for(let k=1; k<=7; k+=2) s += (4/(k*Math.PI))*Math.sin(k*t); return s; })",
                    "mode": "lines",
                    "name": "N=7",
                    "line": {
                        "color": "#4f8cff",
                        "width": 2
                    }
                },
                {
                    "x_expr": "Array.from({length: 400}, (_, i) => -Math.PI + i * 2 * Math.PI / 400)",
                    "y_expr": "Array.from({length: 400}, (_, i) => { const t = -Math.PI + i * 2 * Math.PI / 400; let s = 0; for(let k=1; k<=3; k+=2) s += (4/(k*Math.PI))*Math.sin(k*t); return s; })",
                    "mode": "lines",
                    "name": "N=3",
                    "line": {
                        "color": "#ff6b8a",
                        "width": 1.5,
                        "dash": "dash"
                    }
                }
            ],
            "layout": {
                "xaxis": {
                    "title": "t"
                },
                "yaxis": {
                    "title": "x(t)"
                },
                "showlegend": true
            }
        },
        {
            "id": "duty-cycle-spectrum-sim",
            "type": "v3-waveform",
            "title": "Interactive: Duty Cycle vs Spectrum",
            "description": "Change the duty cycle and watch the sinc envelope shift. Narrow pulses have wider spectra."
        }
    ]
}