{
    "visuals": [
        {
            "id": "parseval-concept-diagram",
            "type": "plotly",
            "title": "Parseval's Theorem: Time Domain Power = Frequency Domain Power",
            "description": "The average power of a periodic signal can be computed either by integrating |x(t)|² over one period, or by summing |X_k|² over all harmonics. Both give the same answer.",
            "traces": [
                {
                    "x": [
                        "Time Domain\n(1/T₀)∫|x(t)|² dt",
                        "=",
                        "Frequency Domain\nΣ |X_k|²"
                    ],
                    "y": [
                        1,
                        1,
                        1
                    ],
                    "type": "bar",
                    "marker": {
                        "color": [
                            "#4f8cff",
                            "#f5a623",
                            "#2fbf8f"
                        ]
                    },
                    "text": [
                        "Average power\nfrom waveform",
                        "Parseval's\nTheorem",
                        "Sum of spectral\ncomponent powers"
                    ],
                    "textposition": "inside",
                    "textfont": {
                        "size": 11,
                        "color": "#ffffff"
                    },
                    "showlegend": false,
                    "hoverinfo": "none"
                }
            ],
            "layout": {
                "xaxis": {
                    "title": ""
                },
                "yaxis": {
                    "visible": false,
                    "range": [
                        0,
                        1.3
                    ]
                },
                "showlegend": false,
                "annotations": [
                    {
                        "x": "=",
                        "y": 1.15,
                        "text": "P_avg = (1/T₀)∫|x(t)|²dt = Σ|X_k|²",
                        "showarrow": false,
                        "font": {
                            "size": 12,
                            "color": "#f5a623"
                        }
                    }
                ]
            },
            "height": 300
        },
        {
            "id": "power-spectrum-bars",
            "type": "plotly",
            "title": "Power Spectrum |X_k|² of a Square Pulse Train",
            "description": "The power in each harmonic is |X_k|². Most power is concentrated in the low harmonics. Higher harmonics contribute diminishing amounts.",
            "traces": [
                {
                    "x_expr": "Array.from({length: 21}, (_, i) => i - 10)",
                    "y_expr": "Array.from({length: 21}, (_, i) => { const k = i - 10; if(k === 0) return 0.25; const v = Math.sin(k * Math.PI * 0.25) / (k * Math.PI); return v * v; })",
                    "type": "bar",
                    "name": "|X_k|²",
                    "marker": {
                        "color": "#4f8cff"
                    }
                }
            ],
            "layout": {
                "xaxis": {
                    "title": "Harmonic k",
                    "dtick": 2
                },
                "yaxis": {
                    "title": "|X_k|²"
                },
                "showlegend": false
            }
        },
        {
            "id": "cumulative-power",
            "type": "plotly",
            "title": "Cumulative Power: How Many Harmonics Capture Most Energy?",
            "description": "As you include more harmonics, the cumulative power approaches the total. For a square wave, ~95% of power is captured within the first 5 harmonics.",
            "traces": [
                {
                    "x_expr": "Array.from({length: 20}, (_, i) => i + 1)",
                    "y_expr": "Array.from({length: 20}, (_, i) => { let s = 0.0625; for(let k=1; k<=i+1; k++) { const v = Math.sin(k * Math.PI * 0.25) / (k * Math.PI); s += 2 * v * v; } return s / 0.25 * 100; })",
                    "mode": "lines+markers",
                    "name": "Cumulative power (%)",
                    "line": {
                        "color": "#2fbf8f",
                        "width": 2.5
                    },
                    "marker": {
                        "size": 6
                    }
                },
                {
                    "x": [
                        0,
                        20
                    ],
                    "y": [
                        95,
                        95
                    ],
                    "mode": "lines",
                    "name": "95% threshold",
                    "line": {
                        "color": "#ff6b8a",
                        "width": 1.5,
                        "dash": "dash"
                    }
                }
            ],
            "layout": {
                "xaxis": {
                    "title": "Number of harmonics included"
                },
                "yaxis": {
                    "title": "% of total power",
                    "range": [
                        0,
                        105
                    ]
                },
                "showlegend": true
            }
        },
        {
            "id": "power-waveform-area",
            "type": "plotly",
            "title": "Time Domain: |x(t)|² and Its Average",
            "description": "The average of |x(t)|² over one period gives the average power. For a square wave with amplitude A, P_avg = A²·(d/T₀) where d is the pulse width.",
            "traces": [
                {
                    "x_expr": "Array.from({length: 400}, (_, i) => i / 400)",
                    "y_expr": "Array.from({length: 400}, (_, i) => { const t = i / 400; return (t < 0.25 || t > 0.75) ? 1 : 0; })",
                    "mode": "lines",
                    "name": "|x(t)|² (square pulse)",
                    "line": {
                        "color": "#4f8cff",
                        "width": 2
                    },
                    "fill": "tozeroy",
                    "fillcolor": "rgba(79,140,255,0.2)"
                },
                {
                    "x": [
                        0,
                        1
                    ],
                    "y": [
                        0.5,
                        0.5
                    ],
                    "mode": "lines",
                    "name": "Average = P_avg = 0.5",
                    "line": {
                        "color": "#ff6b8a",
                        "width": 2,
                        "dash": "dash"
                    }
                }
            ],
            "layout": {
                "xaxis": {
                    "title": "t / T₀"
                },
                "yaxis": {
                    "title": "|x(t)|²",
                    "range": [
                        -0.1,
                        1.3
                    ]
                },
                "showlegend": true
            }
        },
        {
            "id": "parseval-verification-sim",
            "type": "v3-waveform",
            "title": "Interactive: Verify Parseval's Theorem",
            "description": "Compute power in both domains and verify they match. Add harmonics one by one and watch the frequency-domain sum approach the time-domain integral."
        },
        {
            "id": "bandwidth-power-tradeoff",
            "type": "plotly",
            "title": "Bandwidth Estimation: 95% Power Bandwidth",
            "description": "The 95% power bandwidth is the range of harmonics that capture 95% of the signal's power. Smoother signals have narrower bandwidth.",
            "traces": [
                {
                    "x": [
                        "Square wave",
                        "Triangle wave",
                        "Sinusoid"
                    ],
                    "y": [
                        7,
                        3,
                        1
                    ],
                    "type": "bar",
                    "name": "Harmonics for 95% power",
                    "marker": {
                        "color": [
                            "#ff6b8a",
                            "#6b62ff",
                            "#2fbf8f"
                        ]
                    },
                    "text": [
                        "7 harmonics\n(slow 1/k decay)",
                        "3 harmonics\n(fast 1/k² decay)",
                        "1 harmonic\n(pure tone)"
                    ],
                    "textposition": "inside",
                    "textfont": {
                        "size": 11,
                        "color": "#ffffff"
                    }
                }
            ],
            "layout": {
                "xaxis": {
                    "title": "Signal Type"
                },
                "yaxis": {
                    "title": "Harmonics needed for 95% power"
                },
                "showlegend": false
            },
            "height": 300
        },
        {
            "id": "rms-from-spectrum",
            "type": "plotly",
            "title": "RMS Value from Fourier Coefficients",
            "description": "x_rms = √(P_avg) = √(Σ|X_k|²). You can compute RMS directly from the spectrum without ever going to the time domain.",
            "traces": [
                {
                    "x": [
                        "Parseval:\nP_avg = Σ|X_k|²",
                        "→ RMS →",
                        "x_rms = √(P_avg)\n= √(Σ|X_k|²)"
                    ],
                    "y": [
                        1,
                        1,
                        1
                    ],
                    "type": "bar",
                    "marker": {
                        "color": [
                            "#4f8cff",
                            "#f5a623",
                            "#2fbf8f"
                        ]
                    },
                    "text": [
                        "Sum spectral\npower",
                        "Take square\nroot",
                        "RMS from\nfrequency domain!"
                    ],
                    "textposition": "inside",
                    "textfont": {
                        "size": 11,
                        "color": "#ffffff"
                    },
                    "showlegend": false,
                    "hoverinfo": "none"
                }
            ],
            "layout": {
                "xaxis": {
                    "title": ""
                },
                "yaxis": {
                    "visible": false,
                    "range": [
                        0,
                        1.3
                    ]
                },
                "showlegend": false
            },
            "height": 260
        },
        {
            "id": "harmonic-power-pie",
            "type": "plotly",
            "title": "Power Distribution: DC vs 1st vs Higher Harmonics",
            "description": "For a typical signal, the DC term and fundamental harmonic carry most of the power. Higher harmonics contribute diminishing fractions.",
            "traces": [
                {
                    "labels": [
                        "DC (|X₀|²)",
                        "1st harmonic (|X₁|²)",
                        "3rd harmonic",
                        "5th harmonic",
                        "Higher"
                    ],
                    "values": [
                        25,
                        40,
                        20,
                        10,
                        5
                    ],
                    "type": "pie",
                    "marker": {
                        "colors": [
                            "#f5a623",
                            "#4f8cff",
                            "#6b62ff",
                            "#2fbf8f",
                            "#aab4c0"
                        ]
                    },
                    "textinfo": "label+percent",
                    "textfont": {
                        "size": 12,
                        "color": "#ffffff"
                    },
                    "hole": 0.3
                }
            ],
            "layout": {
                "showlegend": false
            },
            "height": 350
        },
        {
            "id": "signal-power-comparison",
            "type": "v3-waveform",
            "title": "Interactive: Compare RMS of Different Waveforms",
            "description": "Switch between square, triangle, and sawtooth waveforms. Compare their RMS values computed from both time and frequency domains."
        },
        {
            "id": "power-in-band",
            "type": "plotly",
            "title": "Waveform View: Signal Reconstructed with Limited Bandwidth",
            "description": "A signal reconstructed with only the first few harmonics vs the full signal. The limited-bandwidth version captures most of the energy but loses sharp features.",
            "traces": [
                {
                    "x_expr": "Array.from({length: 400}, (_, i) => -Math.PI + i * 2 * Math.PI / 400)",
                    "y_expr": "Array.from({length: 400}, (_, i) => { const t = -Math.PI + i * 2 * Math.PI / 400; let s = 0; for(let k=1; k<=21; k+=2) s += (4/(k*Math.PI))*Math.sin(k*t); return s; })",
                    "mode": "lines",
                    "name": "Full signal (many harmonics)",
                    "line": {
                        "color": "#4f8cff",
                        "width": 2
                    }
                },
                {
                    "x_expr": "Array.from({length: 400}, (_, i) => -Math.PI + i * 2 * Math.PI / 400)",
                    "y_expr": "Array.from({length: 400}, (_, i) => { const t = -Math.PI + i * 2 * Math.PI / 400; let s = 0; for(let k=1; k<=3; k+=2) s += (4/(k*Math.PI))*Math.sin(k*t); return s; })",
                    "mode": "lines",
                    "name": "Limited bandwidth (k ≤ 3)",
                    "line": {
                        "color": "#ff6b8a",
                        "width": 2.5,
                        "dash": "dash"
                    }
                }
            ],
            "layout": {
                "xaxis": {
                    "title": "t"
                },
                "yaxis": {
                    "title": "x(t)"
                },
                "showlegend": true
            }
        }
    ]
}