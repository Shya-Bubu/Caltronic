{
    "visuals": [
        {
            "id": "parseval-concept-diagram",
            "type": "d3-block-diagram",
            "title": "Parseval's Theorem: Time Domain Power = Frequency Domain Power",
            "description": "The average power of a periodic signal can be computed either as the time integral of |x(t)|² or as the sum of |X_k|². Both give the same answer — energy is conserved between domains.",
            "blocks": [
                {
                    "id": "time",
                    "label": "Time Domain\nP = (1/T₀)∫|x(t)|² dt",
                    "x": 60,
                    "y": 60,
                    "width": 250,
                    "height": 55,
                    "fill": "#4f8cff"
                },
                {
                    "id": "freq",
                    "label": "Frequency Domain\nP = Σ|X_k|²",
                    "x": 380,
                    "y": 60,
                    "width": 220,
                    "height": 55,
                    "fill": "#ff6b8a"
                },
                {
                    "id": "equal",
                    "label": "P_time = P_freq\nEnergy is\nconserved!",
                    "x": 220,
                    "y": 155,
                    "width": 220,
                    "height": 55,
                    "fill": "#2fbf8f"
                }
            ],
            "connections": [
                {
                    "from": "time",
                    "to": "equal"
                },
                {
                    "from": "freq",
                    "to": "equal"
                }
            ]
        },
        {
            "id": "power-spectrum-bars",
            "type": "plotly",
            "title": "Power Spectrum |X_k|² of a Square Pulse Train",
            "description": "Each bar shows the power carried by the k-th harmonic. The sum of all bars equals the average power computed in the time domain. Most power is in the low harmonics (main lobe).",
            "traces": [
                {
                    "x_expr": "Array.from({length: 21}, (_, i) => i - 10)",
                    "y_expr": "Array.from({length: 21}, (_, i) => { const k = i - 10; if(k === 0) return 0.0625; const v = Math.sin(k * Math.PI / 4) / (k * Math.PI); return v * v; })",
                    "type": "bar",
                    "name": "|X_k|²",
                    "marker": {
                        "color": "#6b62ff"
                    }
                }
            ],
            "layout": {
                "xaxis": {
                    "title": "Harmonic k",
                    "dtick": 2
                },
                "yaxis": {
                    "title": "|X_k|²"
                },
                "showlegend": false
            }
        },
        {
            "id": "cumulative-power",
            "type": "plotly",
            "title": "Cumulative Power: How Many Harmonics Capture Most Energy?",
            "description": "Running sum of |X_k|² as harmonics are added. For the square pulse (25% duty cycle), the first 8 harmonics capture ~95% of the total power. This defines the effective bandwidth.",
            "traces": [
                {
                    "x_expr": "Array.from({length: 16}, (_, i) => i)",
                    "y_expr": "(() => { const vals = []; let sum = 0.0625; vals.push(sum); for(let k=1; k<=15; k++) { const v = Math.sin(k*Math.PI/4)/(k*Math.PI); sum += 2*v*v; vals.push(sum); } const total = sum; return vals.map(v => v/total * 100); })()",
                    "mode": "lines+markers",
                    "name": "% of total power",
                    "line": {
                        "color": "#4f8cff",
                        "width": 2.5
                    },
                    "marker": {
                        "size": 6
                    }
                }
            ],
            "layout": {
                "xaxis": {
                    "title": "Number of harmonics included"
                },
                "yaxis": {
                    "title": "% of total power",
                    "range": [
                        0,
                        105
                    ]
                },
                "showlegend": false
            }
        },
        {
            "id": "power-waveform-area",
            "type": "plotly",
            "title": "Time Domain: |x(t)|² and Its Average",
            "description": "The squared signal |x(t)|². For the square pulse, |x(t)|² = x(t) (since the pulse is 0 or 1). The average value (shaded) equals the duty cycle, which matches Σ|X_k|².",
            "traces": [
                {
                    "x_expr": "(() => { const pts = []; for(let m=-1; m<=1; m++) { const c = m*4; pts.push(c-0.5-0.01, c-0.5, c-0.5, c+0.5, c+0.5, c+0.5+0.01); } return pts; })()",
                    "y_expr": "(() => { const pts = []; for(let m=-1; m<=1; m++) { pts.push(0, 0, 1, 1, 0, 0); } return pts; })()",
                    "mode": "lines",
                    "name": "|x(t)|²",
                    "line": {
                        "color": "#4f8cff",
                        "width": 2.5
                    },
                    "fill": "tozeroy",
                    "fillcolor": "rgba(79,140,255,0.2)"
                },
                {
                    "x": [
                        -6,
                        6
                    ],
                    "y": [
                        0.25,
                        0.25
                    ],
                    "mode": "lines",
                    "name": "Average power = 0.25",
                    "line": {
                        "color": "#ff6b8a",
                        "width": 2,
                        "dash": "dash"
                    }
                }
            ],
            "layout": {
                "xaxis": {
                    "title": "t (seconds)",
                    "range": [
                        -5,
                        5
                    ]
                },
                "yaxis": {
                    "title": "|x(t)|²",
                    "range": [
                        0,
                        1.3
                    ]
                },
                "showlegend": true
            }
        },
        {
            "id": "parseval-verification-sim",
            "type": "d3-simulation",
            "simulationType": "fourier-coefficients",
            "title": "Interactive: Verify Parseval's Theorem",
            "description": "Choose a signal and watch both the time-domain power integral and the frequency-domain sum |X_k|² update. They always match, confirming Parseval's theorem."
        },
        {
            "id": "bandwidth-power-tradeoff",
            "type": "plotly",
            "title": "Bandwidth Estimation: 95% Power Bandwidth",
            "description": "The 95% power bandwidth is the number of harmonics needed to capture 95% of the total power. Narrow pulses need more harmonics (wider bandwidth) to capture the same fraction of power.",
            "traces": [
                {
                    "x": [
                        "10%",
                        "25%",
                        "50%",
                        "75%"
                    ],
                    "y": [
                        16,
                        8,
                        4,
                        2
                    ],
                    "type": "bar",
                    "name": "Harmonics for 95% power",
                    "marker": {
                        "color": "#6b62ff"
                    }
                }
            ],
            "layout": {
                "xaxis": {
                    "title": "Duty Cycle"
                },
                "yaxis": {
                    "title": "Number of harmonics (approx)"
                },
                "showlegend": false
            }
        },
        {
            "id": "rms-from-spectrum",
            "type": "d3-block-diagram",
            "title": "RMS Value from Fourier Coefficients",
            "description": "The RMS value of a signal equals the square root of the sum of |X_k|². This is often the fastest way to compute RMS for signals whose FS is known.",
            "blocks": [
                {
                    "id": "coeffs",
                    "label": "FS Coefficients\nX₀, X₁, X₂, ...",
                    "x": 80,
                    "y": 60,
                    "width": 200,
                    "height": 50,
                    "fill": "#4f8cff"
                },
                {
                    "id": "sum",
                    "label": "Power = |X₀|² + 2Σ|Xₖ|²\n(for real signals)",
                    "x": 340,
                    "y": 60,
                    "width": 230,
                    "height": 50,
                    "fill": "#6b62ff"
                },
                {
                    "id": "rms",
                    "label": "RMS = √Power",
                    "x": 210,
                    "y": 150,
                    "width": 200,
                    "height": 45,
                    "fill": "#2fbf8f"
                }
            ],
            "connections": [
                {
                    "from": "coeffs",
                    "to": "sum"
                },
                {
                    "from": "sum",
                    "to": "rms"
                }
            ]
        },
        {
            "id": "harmonic-power-pie",
            "type": "plotly",
            "title": "Power Distribution: DC vs 1st vs Higher Harmonics",
            "description": "For the 25% duty cycle square pulse, the DC component carries the largest share of power, the fundamental carries the next largest, and higher harmonics carry progressively less.",
            "traces": [
                {
                    "labels": [
                        "DC (k=0)",
                        "k=±1",
                        "k=±2",
                        "k=±3",
                        "k=±4+"
                    ],
                    "values": [
                        25.0,
                        40.5,
                        20.3,
                        4.5,
                        9.7
                    ],
                    "type": "pie",
                    "marker": {
                        "colors": [
                            "#4f8cff",
                            "#6b62ff",
                            "#ff6b8a",
                            "#f5a623",
                            "#2fbf8f"
                        ]
                    }
                }
            ],
            "layout": {
                "showlegend": true
            }
        },
        {
            "id": "signal-power-comparison",
            "type": "d3-simulation",
            "simulationType": "signal-generator",
            "title": "Interactive: Compare RMS of Different Waveforms",
            "description": "Switch between square, triangular, and sawtooth waveforms with the same peak amplitude. Observe how the RMS values differ because the power distributions across harmonics are different."
        },
        {
            "id": "power-in-band",
            "type": "d3-waveform",
            "title": "Waveform View: Signal Reconstructed with Limited Bandwidth",
            "description": "Shows the original signal and a band-limited version using only the first N harmonics. The error between them represents the power outside the band — quantified by Parseval's theorem.",
            "waveType": "rect",
            "mode": "continuous"
        }
    ]
}