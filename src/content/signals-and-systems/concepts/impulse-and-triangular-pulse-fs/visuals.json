{
    "visuals": [
        {
            "id": "impulse-train-waveform",
            "type": "plotly",
            "title": "The Periodic Impulse Train",
            "description": "An infinite train of equally-spaced Dirac impulses, each separated by T₀ seconds. Despite having zero width, each impulse has unit area.",
            "traces": [
                {
                    "x": [
                        -2,
                        -2,
                        -2,
                        -1,
                        -1,
                        -1,
                        0,
                        0,
                        0,
                        1,
                        1,
                        1,
                        2,
                        2,
                        2
                    ],
                    "y": [
                        0,
                        1,
                        0,
                        0,
                        1,
                        0,
                        0,
                        1,
                        0,
                        0,
                        1,
                        0,
                        0,
                        1,
                        0
                    ],
                    "mode": "lines",
                    "name": "δ(t − nT₀)",
                    "line": {
                        "color": "#4f8cff",
                        "width": 3
                    }
                },
                {
                    "x": [
                        -2,
                        -1,
                        0,
                        1,
                        2
                    ],
                    "y": [
                        1,
                        1,
                        1,
                        1,
                        1
                    ],
                    "mode": "markers",
                    "name": "Impulse tips",
                    "marker": {
                        "size": 10,
                        "color": "#ff6b8a",
                        "symbol": "triangle-up"
                    },
                    "showlegend": false
                }
            ],
            "layout": {
                "xaxis": {
                    "title": "t / T₀",
                    "dtick": 1
                },
                "yaxis": {
                    "title": "δ(t)",
                    "range": [
                        -0.1,
                        1.3
                    ]
                },
                "showlegend": true,
                "annotations": [
                    {
                        "x": 0,
                        "y": 1.15,
                        "text": "Area = 1",
                        "showarrow": false,
                        "font": {
                            "size": 11,
                            "color": "#f5a623"
                        }
                    }
                ]
            }
        },
        {
            "id": "impulse-flat-spectrum",
            "type": "plotly",
            "title": "Impulse Train Spectrum: All Harmonics Equal",
            "description": "Every coefficient X_k = 1/T₀ — flat magnitude across all harmonics. The impulse train contains all frequencies equally.",
            "traces": [
                {
                    "x": [
                        -8,
                        -7,
                        -6,
                        -5,
                        -4,
                        -3,
                        -2,
                        -1,
                        0,
                        1,
                        2,
                        3,
                        4,
                        5,
                        6,
                        7,
                        8
                    ],
                    "y": [
                        0.25,
                        0.25,
                        0.25,
                        0.25,
                        0.25,
                        0.25,
                        0.25,
                        0.25,
                        0.25,
                        0.25,
                        0.25,
                        0.25,
                        0.25,
                        0.25,
                        0.25,
                        0.25,
                        0.25
                    ],
                    "type": "bar",
                    "name": "X_k = 1/T₀ = 0.25",
                    "marker": {
                        "color": "#4f8cff"
                    }
                }
            ],
            "layout": {
                "xaxis": {
                    "title": "Harmonic k",
                    "dtick": 2
                },
                "yaxis": {
                    "title": "|X_k|",
                    "range": [
                        0,
                        0.35
                    ]
                },
                "showlegend": false
            }
        },
        {
            "id": "impulse-derivation-diagram",
            "type": "plotly",
            "title": "Deriving the Impulse Train FS",
            "description": "The sifting property of δ(t) extracts the value at t = 0. Since e^{−jkω₀·0} = 1, every coefficient evaluates to 1/T₀ regardless of k.",
            "traces": [
                {
                    "x": [
                        "Analysis formula\nX_k = (1/T₀)∫ δ(t)e^{−jkω₀t} dt",
                        "→ Sifting →\nδ(t) samples at t=0",
                        "Result:\nX_k = 1/T₀ for all k"
                    ],
                    "y": [
                        1,
                        1,
                        1
                    ],
                    "type": "bar",
                    "marker": {
                        "color": [
                            "#4f8cff",
                            "#6b62ff",
                            "#2fbf8f"
                        ]
                    },
                    "text": [
                        "Analysis\nintegral",
                        "e^{−jk·0} = 1\nt=0 extraction",
                        "Flat spectrum!\nAll harmonics equal"
                    ],
                    "textposition": "inside",
                    "textfont": {
                        "size": 10,
                        "color": "#ffffff"
                    },
                    "showlegend": false,
                    "hoverinfo": "none"
                }
            ],
            "layout": {
                "xaxis": {
                    "title": ""
                },
                "yaxis": {
                    "visible": false,
                    "range": [
                        0,
                        1.3
                    ]
                },
                "showlegend": false
            },
            "height": 280
        },
        {
            "id": "triangular-pulse-waveform",
            "type": "plotly",
            "title": "The Triangular Pulse Train",
            "description": "A periodic triangular wave that ramps linearly up and down. Continuous everywhere but has corners at peaks and valleys. Derived by integrating a square wave.",
            "traces": [
                {
                    "x_expr": "Array.from({length: 400}, (_, i) => -2 + i * 4 / 400)",
                    "y_expr": "Array.from({length: 400}, (_, i) => { const t = (-2 + i * 4 / 400) % 1; const a = t < 0 ? t + 1 : t; return a < 0.5 ? 4*a - 1 : 3 - 4*a; })",
                    "mode": "lines",
                    "name": "Triangular wave",
                    "line": {
                        "color": "#6b62ff",
                        "width": 2.5
                    }
                }
            ],
            "layout": {
                "xaxis": {
                    "title": "t / T₀"
                },
                "yaxis": {
                    "title": "x(t)",
                    "range": [
                        -1.3,
                        1.3
                    ]
                },
                "showlegend": true
            }
        },
        {
            "id": "triangular-spectrum",
            "type": "plotly",
            "title": "Triangular Pulse Spectrum: sinc² Envelope",
            "description": "The coefficients follow a sinc² envelope, decaying as 1/k². The faster decay reflects the triangular wave's continuity.",
            "traces": [
                {
                    "x_expr": "Array.from({length: 31}, (_, i) => i - 15)",
                    "y_expr": "Array.from({length: 31}, (_, i) => { const k = i - 15; if(k === 0) return 0.25; const val = Math.sin(k * Math.PI / 4) / (k * Math.PI / 4); return 0.25 * val * val; })",
                    "type": "bar",
                    "name": "|X_k| (sinc² envelope)",
                    "marker": {
                        "color": "#6b62ff"
                    }
                }
            ],
            "layout": {
                "xaxis": {
                    "title": "Harmonic k",
                    "dtick": 3
                },
                "yaxis": {
                    "title": "|X_k|"
                },
                "bargap": 0.3,
                "showlegend": false
            }
        },
        {
            "id": "square-vs-triangle-spectrum",
            "type": "plotly",
            "title": "Decay Comparison: Square (1/k) vs Triangular (1/k²)",
            "description": "The square wave coefficients decay as 1/k (slow). The triangular wave decays as 1/k² (fast). Extra smoothness buys faster convergence.",
            "traces": [
                {
                    "x_expr": "Array.from({length: 21}, (_, i) => i + 1)",
                    "y_expr": "Array.from({length: 21}, (_, i) => 1 / (i + 1))",
                    "mode": "lines+markers",
                    "name": "1/k (square wave)",
                    "line": {
                        "color": "#ff6b8a",
                        "width": 2
                    },
                    "marker": {
                        "size": 5
                    }
                },
                {
                    "x_expr": "Array.from({length: 21}, (_, i) => i + 1)",
                    "y_expr": "Array.from({length: 21}, (_, i) => 1 / ((i + 1) * (i + 1)))",
                    "mode": "lines+markers",
                    "name": "1/k² (triangular wave)",
                    "line": {
                        "color": "#2fbf8f",
                        "width": 2
                    },
                    "marker": {
                        "size": 5
                    }
                }
            ],
            "layout": {
                "xaxis": {
                    "title": "Harmonic k"
                },
                "yaxis": {
                    "title": "Coefficient magnitude (normalised)",
                    "type": "log"
                },
                "showlegend": true
            }
        },
        {
            "id": "integration-chain-diagram",
            "type": "plotly",
            "title": "Integration Chain: Impulse → Square → Triangle",
            "description": "Each integration smooths the signal and adds 1/k to the decay rate. Impulse (flat) → integrate → square (1/k) → integrate → triangle (1/k²).",
            "traces": [
                {
                    "x": [
                        "Impulse Train\n|X_k| = const",
                        "→ ∫dt →",
                        "Square Wave\n|X_k| ∝ 1/k",
                        "→ ∫dt →",
                        "Triangle Wave\n|X_k| ∝ 1/k²"
                    ],
                    "y": [
                        1,
                        1,
                        1,
                        1,
                        1
                    ],
                    "type": "bar",
                    "marker": {
                        "color": [
                            "#ff6b8a",
                            "#aab4c0",
                            "#4f8cff",
                            "#aab4c0",
                            "#2fbf8f"
                        ]
                    },
                    "text": [
                        "Flat\nspectrum",
                        "Integrate\n(÷jkω₀)",
                        "sinc\nenvelope",
                        "Integrate\nagain",
                        "sinc²\nenvelope"
                    ],
                    "textposition": "inside",
                    "textfont": {
                        "size": 10,
                        "color": "#ffffff"
                    },
                    "showlegend": false,
                    "hoverinfo": "none"
                }
            ],
            "layout": {
                "xaxis": {
                    "title": ""
                },
                "yaxis": {
                    "visible": false,
                    "range": [
                        0,
                        1.3
                    ]
                },
                "showlegend": false,
                "annotations": [
                    {
                        "x": "→ ∫dt →",
                        "y": 1.15,
                        "text": "Each ∫ adds 1/k decay",
                        "showarrow": false,
                        "font": {
                            "size": 11,
                            "color": "#f5a623"
                        }
                    }
                ]
            },
            "height": 300
        },
        {
            "id": "triangle-reconstruction-sim",
            "type": "v3-waveform",
            "title": "Interactive: Reconstruct the Triangular Wave from Harmonics",
            "description": "Build the triangular wave by adding harmonics. Notice how much fewer terms are needed compared to the square wave."
        },
        {
            "id": "tri-vs-square-convergence",
            "type": "plotly",
            "title": "Convergence: Triangle (5 harmonics) vs Square (5 harmonics)",
            "description": "With 5 harmonics, the triangular reconstruction is nearly perfect while the square wave still has visible Gibbs overshoot.",
            "traces": [
                {
                    "x_expr": "Array.from({length: 400}, (_, i) => -Math.PI + i * 2 * Math.PI / 400)",
                    "y_expr": "Array.from({length: 400}, (_, i) => { const t = -Math.PI + i * 2 * Math.PI / 400; let s = 0; for(let n=0; n<5; n++) { const k = 2*n+1; s += (8/(k*k*Math.PI*Math.PI))*Math.pow(-1,n)*Math.cos(k*t); } return s; })",
                    "mode": "lines",
                    "name": "Triangle (5 harmonics)",
                    "line": {
                        "color": "#2fbf8f",
                        "width": 2.5
                    }
                },
                {
                    "x_expr": "Array.from({length: 400}, (_, i) => -Math.PI + i * 2 * Math.PI / 400)",
                    "y_expr": "Array.from({length: 400}, (_, i) => { const t = -Math.PI + i * 2 * Math.PI / 400; let s = 0; for(let k=1; k<=9; k+=2) s += (4/(k*Math.PI))*Math.sin(k*t); return s; })",
                    "mode": "lines",
                    "name": "Square (5 harmonics)",
                    "line": {
                        "color": "#ff6b8a",
                        "width": 2,
                        "dash": "dash"
                    }
                }
            ],
            "layout": {
                "xaxis": {
                    "title": "t"
                },
                "yaxis": {
                    "title": "x(t)"
                },
                "showlegend": true
            }
        },
        {
            "id": "coefficient-decay-explorer",
            "type": "v3-waveform",
            "title": "Interactive: Compare Coefficient Decay Rates",
            "description": "Switch between impulse, square, and triangular waveforms. Watch how the spectrum changes from flat to 1/k to 1/k²."
        }
    ]
}