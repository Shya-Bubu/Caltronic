{
    "visuals": [
        {
            "id": "efs-block-diagram",
            "type": "plotly",
            "title": "The Exponential Fourier Series: Analysis and Synthesis",
            "description": "Any periodic signal can be decomposed into complex exponentials e^{jkω₀t}. Analysis extracts coefficients; synthesis reconstructs the signal.",
            "traces": [
                {
                    "x": [
                        "x(t)\nPeriodic signal",
                        "→ Analysis →\nX_k = (1/T₀)∫x(t)e^{−jkω₀t}dt",
                        "→ Synthesis →\nx(t) = Σ X_k e^{jkω₀t}"
                    ],
                    "y": [
                        1,
                        1,
                        1
                    ],
                    "type": "bar",
                    "marker": {
                        "color": [
                            "#4f8cff",
                            "#f5a623",
                            "#2fbf8f"
                        ]
                    },
                    "text": [
                        "Time domain\nwaveform",
                        "Extract frequency\ncomponents",
                        "Reconstruct from\nharmonics"
                    ],
                    "textposition": "inside",
                    "textfont": {
                        "size": 10,
                        "color": "#ffffff"
                    },
                    "showlegend": false,
                    "hoverinfo": "none"
                }
            ],
            "layout": {
                "xaxis": {
                    "title": ""
                },
                "yaxis": {
                    "visible": false,
                    "range": [
                        0,
                        1.3
                    ]
                },
                "showlegend": false
            },
            "height": 280
        },
        {
            "id": "orthogonality-cancellation",
            "type": "plotly",
            "title": "Orthogonality: Why Non-Matching Harmonics Cancel",
            "description": "When you multiply x(t) by e^{−jkω₀t} and integrate, all harmonics except the k-th cancel due to orthogonality. The product of different harmonics integrates to zero.",
            "traces": [
                {
                    "x_expr": "Array.from({length: 300}, (_, i) => i * 2 * Math.PI / 300)",
                    "y_expr": "Array.from({length: 300}, (_, i) => Math.cos(i * 2 * Math.PI / 300) * Math.cos(3 * i * 2 * Math.PI / 300))",
                    "mode": "lines",
                    "name": "cos(ω₀t)·cos(3ω₀t) → ∫ = 0",
                    "line": {
                        "color": "#ff6b8a",
                        "width": 2
                    }
                },
                {
                    "x_expr": "Array.from({length: 300}, (_, i) => i * 2 * Math.PI / 300)",
                    "y_expr": "Array.from({length: 300}, (_, i) => Math.cos(i * 2 * Math.PI / 300) * Math.cos(i * 2 * Math.PI / 300))",
                    "mode": "lines",
                    "name": "cos(ω₀t)·cos(ω₀t) → ∫ = T₀/2",
                    "line": {
                        "color": "#2fbf8f",
                        "width": 2
                    }
                }
            ],
            "layout": {
                "xaxis": {
                    "title": "t"
                },
                "yaxis": {
                    "title": "Product"
                },
                "showlegend": true
            }
        },
        {
            "id": "frequency-sieve-diagram",
            "type": "plotly",
            "title": "The Analysis Integral as a Frequency Sieve",
            "description": "Multiplying x(t) by e^{−jkω₀t} and integrating isolates the k-th harmonic. All other harmonics integrate to zero.",
            "traces": [
                {
                    "x": [
                        "x(t) × e^{−jkω₀t}",
                        "→ Integrate over T₀ →",
                        "Only k-th survives"
                    ],
                    "y": [
                        1,
                        1,
                        1
                    ],
                    "type": "bar",
                    "marker": {
                        "color": [
                            "#4f8cff",
                            "#f5a623",
                            "#2fbf8f"
                        ]
                    },
                    "text": [
                        "Multiply by\ncomplex conjugate",
                        "Orthogonality kills\nall other harmonics",
                        "X_k extracted!\nAll others = 0"
                    ],
                    "textposition": "inside",
                    "textfont": {
                        "size": 10,
                        "color": "#ffffff"
                    },
                    "showlegend": false,
                    "hoverinfo": "none"
                }
            ],
            "layout": {
                "xaxis": {
                    "title": ""
                },
                "yaxis": {
                    "visible": false,
                    "range": [
                        0,
                        1.3
                    ]
                },
                "showlegend": false
            },
            "height": 280
        },
        {
            "id": "dc-component-area",
            "type": "plotly",
            "title": "The DC Component X₀ = Average Value of x(t)",
            "description": "X₀ = (1/T₀)∫x(t)dt is the average value. Geometrically, it's the area under one period divided by T₀.",
            "traces": [
                {
                    "x_expr": "Array.from({length: 400}, (_, i) => i / 400)",
                    "y_expr": "Array.from({length: 400}, (_, i) => { const t = i / 400; return (t < 0.25 || t > 0.75) ? 1 : 0; })",
                    "mode": "lines",
                    "name": "x(t) (square pulse)",
                    "line": {
                        "color": "#4f8cff",
                        "width": 2
                    },
                    "fill": "tozeroy",
                    "fillcolor": "rgba(79,140,255,0.2)"
                },
                {
                    "x": [
                        0,
                        1
                    ],
                    "y": [
                        0.5,
                        0.5
                    ],
                    "mode": "lines",
                    "name": "X₀ = average = 0.5",
                    "line": {
                        "color": "#ff6b8a",
                        "width": 2,
                        "dash": "dash"
                    }
                }
            ],
            "layout": {
                "xaxis": {
                    "title": "t / T₀"
                },
                "yaxis": {
                    "title": "x(t)"
                },
                "showlegend": true
            }
        },
        {
            "id": "efs-step-by-step",
            "type": "plotly",
            "title": "EFS Calculation: Step-by-Step",
            "description": "Step 1: Identify T₀ and ω₀. Step 2: Choose integration window. Step 3: Evaluate the analysis integral. Step 4: General formula for X_k.",
            "traces": [
                {
                    "x": [
                        "Step 1:\nFind T₀, ω₀",
                        "Step 2:\nChoose window",
                        "Step 3:\nEvaluate integral",
                        "Step 4:\nGeneral X_k"
                    ],
                    "y": [
                        1,
                        1,
                        1,
                        1
                    ],
                    "type": "bar",
                    "marker": {
                        "color": [
                            "#4f8cff",
                            "#6b62ff",
                            "#ff6b8a",
                            "#2fbf8f"
                        ]
                    },
                    "text": [
                        "T₀ = period\nω₀ = 2π/T₀",
                        "Any interval\nof length T₀",
                        "X_k = (1/T₀)∫\nx(t)e^{−jkω₀t}dt",
                        "Simplify\nfor all k"
                    ],
                    "textposition": "inside",
                    "textfont": {
                        "size": 10,
                        "color": "#ffffff"
                    },
                    "showlegend": false,
                    "hoverinfo": "none"
                }
            ],
            "layout": {
                "xaxis": {
                    "title": ""
                },
                "yaxis": {
                    "visible": false,
                    "range": [
                        0,
                        1.3
                    ]
                },
                "showlegend": false
            },
            "height": 280
        },
        {
            "id": "integration-window-choice",
            "type": "plotly",
            "title": "Any Integration Window of Length T₀ Gives the Same X_k",
            "description": "You can integrate from 0 to T₀, or −T₀/2 to T₀/2, or any interval of length T₀. The result is always the same.",
            "traces": [
                {
                    "x_expr": "Array.from({length: 400}, (_, i) => -2 + i * 4 / 400)",
                    "y_expr": "Array.from({length: 400}, (_, i) => { const t = -2 + i * 4 / 400; return Math.sin(2*Math.PI*t) + 0.3*Math.sin(6*Math.PI*t); })",
                    "mode": "lines",
                    "name": "x(t)",
                    "line": {
                        "color": "#4f8cff",
                        "width": 2
                    }
                },
                {
                    "x": [
                        0,
                        0
                    ],
                    "y": [
                        -1.5,
                        1.5
                    ],
                    "mode": "lines",
                    "name": "Window 1: [0, T₀]",
                    "line": {
                        "color": "#ff6b8a",
                        "width": 2,
                        "dash": "dot"
                    }
                },
                {
                    "x": [
                        1,
                        1
                    ],
                    "y": [
                        -1.5,
                        1.5
                    ],
                    "mode": "lines",
                    "showlegend": false,
                    "line": {
                        "color": "#ff6b8a",
                        "width": 2,
                        "dash": "dot"
                    }
                },
                {
                    "x": [
                        -0.5,
                        -0.5
                    ],
                    "y": [
                        -1.5,
                        1.5
                    ],
                    "mode": "lines",
                    "name": "Window 2: [−T₀/2, T₀/2]",
                    "line": {
                        "color": "#2fbf8f",
                        "width": 2,
                        "dash": "dash"
                    }
                },
                {
                    "x": [
                        0.5,
                        0.5
                    ],
                    "y": [
                        -1.5,
                        1.5
                    ],
                    "mode": "lines",
                    "showlegend": false,
                    "line": {
                        "color": "#2fbf8f",
                        "width": 2,
                        "dash": "dash"
                    }
                }
            ],
            "layout": {
                "xaxis": {
                    "title": "t / T₀"
                },
                "yaxis": {
                    "title": "x(t)"
                },
                "showlegend": true
            }
        },
        {
            "id": "harmonic-builder-efs",
            "type": "v3-waveform",
            "title": "Interactive: Build a Signal from Exponential Harmonics",
            "description": "Add complex exponential harmonics one by one. Watch ±k pairs combine into real sinusoids."
        },
        {
            "id": "coefficient-calculator",
            "type": "v3-waveform",
            "title": "Interactive: Coefficient Calculator",
            "description": "Choose a signal (square, sawtooth, triangle) and see Fourier coefficients computed automatically."
        },
        {
            "id": "square-wave-reconstruction",
            "type": "plotly",
            "title": "Square Wave Reconstruction: Partial Sum Convergence",
            "description": "As more harmonics are added, the approximation improves. Near discontinuities, ~9% Gibbs overshoot persists.",
            "traces": [
                {
                    "x_expr": "Array.from({length: 400}, (_, i) => -Math.PI + i * 2 * Math.PI / 400)",
                    "y_expr": "Array.from({length: 400}, (_, i) => { const t = -Math.PI + i * 2 * Math.PI / 400; let s = 0; for(let k=1; k<=11; k+=2) s += (4/(k*Math.PI))*Math.sin(k*t); return s; })",
                    "mode": "lines",
                    "name": "N=11 harmonics",
                    "line": {
                        "color": "#4f8cff",
                        "width": 2.5
                    }
                },
                {
                    "x_expr": "Array.from({length: 400}, (_, i) => -Math.PI + i * 2 * Math.PI / 400)",
                    "y_expr": "Array.from({length: 400}, (_, i) => { const t = -Math.PI + i * 2 * Math.PI / 400; let s = 0; for(let k=1; k<=3; k+=2) s += (4/(k*Math.PI))*Math.sin(k*t); return s; })",
                    "mode": "lines",
                    "name": "N=3 harmonics",
                    "line": {
                        "color": "#ff6b8a",
                        "width": 1.5,
                        "dash": "dash"
                    }
                }
            ],
            "layout": {
                "xaxis": {
                    "title": "t"
                },
                "yaxis": {
                    "title": "x(t)"
                },
                "showlegend": true
            }
        },
        {
            "id": "gibbs-phenomenon",
            "type": "v3-waveform",
            "title": "Interactive: The Gibbs Overshoot",
            "description": "Increase the number of harmonics and observe the persistent ~9% overshoot at discontinuities."
        }
    ]
}